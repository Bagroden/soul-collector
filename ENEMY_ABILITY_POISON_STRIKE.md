# Ядовитый удар (Poison Strike) - Гоблин Вор

## Обзор
"Ядовитый удар" - это способность Гоблина Вора, которая наносит прямой ядовитый урон и накладывает стаки яда на цель. Особенность способности - быстрая перезарядка и возможность быстро накопить 3 стака яда.

## Параметры способности

- **ID**: `poison_strike`
- **Владелец**: Гоблин Вор
- **Тип урона**: Ядовитый
- **Стоимость**: 25 ОВ
- **Кулдаун**: 2 (пропускает 1 ход)
- **Формула урона**: `ловкость * 2.5`
- **Накладывает**: 2 стака яда
- **Урон от яда**: 10 урона за ход за каждый стак
- **Максимум стаков**: 3

## Механика яда

### Система стаков:
1. **Наложение**: При использовании способности накладывается 2 стака яда сразу
2. **Суммирование**: Стаки суммируются (можно иметь 1, 2 или 3 стака одновременно)
3. **Максимум**: Максимум 3 стака (дальнейшие попытки наложения игнорируются)
4. **Урон**: Каждый стак наносит 10 урона за раунд
5. **Длительность**: 5 раундов на стак

### Примеры работы:

#### Пример 1: Полное отравление
```
Раунд 1: Гоблин Вор использует "Ядовитый удар"
- Прямой урон: ловкость * 2.5 = 25 урона
- Наложено: 2 стака яда
- Урон от яда: 2 стака * 10 = 20 урона за ход

Раунд 2: Способность на кулдауне
- Гоблин использует базовую атаку
- Урон от яда: 20 урона

Раунд 3: Гоблин Вор снова использует "Ядовитый удар"
- Прямой урон: 25 урона
- Попытка наложить: 2 стака (но уже есть 2)
- Результат: Достигнут максимум 3 стака!
- Урон от яда: 3 стака * 10 = 30 урона за ход!

Раунд 4: Способность на кулдауне
- Гоблин использует базовую атаку
- Урон от яда: 30 урона (максимум!)
```

#### Пример 2: Частичное отравление
```
Раунд 1: Гоблин Вор использует "Ядовитый удар"
- Наложено: 2 стака яда
- Урон от яда с следующего раунда: 20/ход

Раунд 3: Попытка наложить еще 2 стака
- Уже есть: 2 стака
- Попытка добавить: 2 стака
- Результат: Наложен только 1 стак (лимит 3)
- Сообщение: "Яд достиг максимума! 3 стака"
```

## Реализация

### EnemyAbility.gd
```gdscript
if id == "poison_strike":
    var agility_val = owner.agility if "agility" in owner else 0
    var poison_damage = int(agility_val * 2.5)
    
    var poison_crit = randf() < (get_crit_chance(owner) / 100.0)
    if poison_crit:
        poison_damage = int(poison_damage * 1.5)
    
    return {
        "success": true,
        "damage": poison_damage,
        "is_crit": poison_crit,
        "damage_type": "poison",
        "message": owner.display_name + " использует " + name + "!",
        "poison_strike": true,
        "poison_stacks": 2  # Накладываем 2 стака яда
    }
```

### battle_manager.gd
```gdscript
elif result.get("poison_strike", false):
    player_node.take_damage(damage, damage_type)
    DamageNumberManager.show_damage_on_character(player_node, damage, is_crit, false, false, damage_type)
    
    # Накладываем стаки яда
    var stacks_to_add = result.get("poison_stacks", 2)
    var current_stacks = 0
    
    if player_node.has_effect("poison"):
        var existing_effect = player_node.effects["poison"]
        current_stacks = existing_effect.get("stacks", 1)
    
    # Добавляем стаки (максимум 3)
    for i in range(stacks_to_add):
        if current_stacks < 3:
            player_node.add_effect("poison", 5.0, 1, {"damage_per_turn": 10})
            current_stacks += 1
        else:
            break
    
    # Логируем результат
    if current_stacks >= 3:
        battle_log.log_event("poison_max", enemy_node.display_name, player_node.display_name, 3, "Яд достиг максимума!")
    else:
        battle_log.log_event("poison_applied", enemy_node.display_name, player_node.display_name, current_stacks, "Наложено " + str(stacks_to_add) + " стака яда!")
```

## Балансировка

### Преимущества:
- **Низкая стоимость** (25 ОВ) - можно использовать часто
- **Короткая перезарядка** (1 ход) - можно быстро накопить стаки
- **Высокий урон от яда** - до 30 урона за ход при 3 стаках
- **Прямой урон + урон со временем** - комбинированная угроза

### Недостатки:
- **Ограничение стаков** - максимум 3, избыточные наложения не работают
- **Требует времени** - нужно 2 использования для максимального эффекта
- **Уязвим к очищению** - если есть способности очищения, эффект пропадает
- **Ядовитый урон** - может игнорироваться определенными защитами

### Стратегия использования:
1. **Раннее накопление**: Использовать в начале боя для быстрого накопления стаков
2. **Постоянное давление**: Короткая перезарядка позволяет поддерживать яд на цели
3. **Комбо с другими ядовитыми эффектами**: Если есть пассивки, усиливающие яд
4. **Контроль здоровья**: Особенно опасен против врагов с низкой живучестью

## Взаимодействие с системами

### Кулдауны:
- После использования: кулдаун 2 (пропускает 1 ход)
- Во время кулдауна: Гоблин использует базовую атаку (ловкость + сила)

### Пассивные способности:
- Срабатывают после нанесения урона
- Могут усилить как прямой урон, так и урон от яда

### Эффекты:
- Яд длится 5 раундов
- Каждый раунд наносит урон в начале хода цели
- Стаки обновляют длительность при повторном наложении

---

**Автор**: AI Assistant  
**Дата**: 2024  
**Версия**: 1.0  
**Статус**: ✅ Реализовано

