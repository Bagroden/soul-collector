# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Ä–æ–Ω–∞ –æ—Ç –±–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –≤—Ä–∞–≥–æ–≤

## –î–∞—Ç–∞: 28 –æ–∫—Ç—è–±—Ä—è 2025

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ü–∏—Ñ—Ä—ã —É—Ä–æ–Ω–∞ –æ—Ç –±–∞–∑–æ–≤–æ–π –∞—Ç–∞–∫–∏ –ì–æ–±–ª–∏–Ω–∞ –í–æ—Ä–∞ (–∏ –¥—Ä—É–≥–∏—Ö –≤—Ä–∞–≥–æ–≤).

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–¥–∞ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ:
1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ **–∏–≥—Ä–æ–∫–∞** (`player_attack()`)
2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è **—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π** –≤—Ä–∞–≥–æ–≤
3. –ù–û –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ **–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ** –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –≤—Ä–∞–≥–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `_enemy_action()` (–±–ª–æ–∫ `if not ability_used:`)

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –æ—Ç –±–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –≤—Ä–∞–≥–æ–≤ –≤ `Scripts/Battle/battle_manager.gd`.

### 1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ (—Å—Ç—Ä–æ–∫–∞ ~1121)

**–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ `take_damage()`:**
```gdscript
# –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–≤–æ—Ä–æ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
player_node.take_damage(damage, damage_type)

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â—É—é —Ü–∏—Ñ—Ä—É —É—Ä–æ–Ω–∞ –æ—Ç –±–∞–∑–æ–≤–æ–π –∞—Ç–∞–∫–∏ –≤—Ä–∞–≥–∞
DamageNumberManager.show_damage_on_character(player_node, damage, is_crit, false, false, damage_type)

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–∞—Å—Å–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Ä–∞–≥–∞ –ø—Ä–∏ –∞—Ç–∞–∫–µ
var context_attack = {"damage": damage, "target": player_node, "ability_used": false, "is_critical": is_crit, "damage_type": damage_type}
enemy_node.trigger_passive_abilities(PassiveAbilityClass.TriggerType.ON_ATTACK, player_node, context_attack)
```

### 2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–º–∞—Ö–∞ (—Å—Ç—Ä–æ–∫–∞ ~1066)

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±–ª–æ–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏—è:**
```gdscript
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –º–µ—Ç–∫–æ—Å—Ç–∏ –∏ —É–≤–æ—Ä–æ—Ç–∞
if not _calculate_hit_chance(enemy_node, player_node, "main_attack", "–ë–∞–∑–æ–≤–∞—è –∞—Ç–∞–∫–∞"):
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â—É—é —Ü–∏—Ñ—Ä—É –ø—Ä–æ–º–∞—Ö–∞
    DamageNumberManager.show_damage_on_character(player_node, 0, false, true, false, damage_type)
    _show_message("–í—Ä–∞–≥ –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è!", 1.0)
    
    # –ù–ï –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ö–æ–¥—É –∏–≥—Ä–æ–∫–∞ - –≤—Ä–∞–≥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–≤–æ–π —Ö–æ–¥
    await get_tree().create_timer(0.5).timeout
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Ä–æ–Ω–∞:

**–ü—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏:**
- `damage` - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω
- `is_crit` - –±—ã–ª –ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä
- `false` - –Ω–µ –ø—Ä–æ–º–∞—Ö
- `false` - –Ω–µ –ª–µ—á–µ–Ω–∏–µ
- `damage_type` - —Ç–∏–ø —É—Ä–æ–Ω–∞ ("physical", "magic", "poison" –∏ —Ç.–¥.)

**–ü—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ:**
- `0` - —É—Ä–æ–Ω (–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è)
- `false` - –Ω–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π
- `true` - —ç—Ç–æ –ø—Ä–æ–º–∞—Ö (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–ü–†–û–ú–ê–•!")
- `false` - –Ω–µ –ª–µ—á–µ–Ω–∏–µ
- `damage_type` - —Ç–∏–ø —É—Ä–æ–Ω–∞ (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)

### –¢–∏–ø—ã —É—Ä–æ–Ω–∞ –±–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –≤—Ä–∞–≥–æ–≤:

1. **–§–∏–∑–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω** (`"physical"`):
   - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤—Ä–∞–≥–æ–≤ (–ö—Ä—ã—Å–∞, –ì–æ–±–ª–∏–Ω –í–æ—Ä, –ì–æ–±–ª–∏–Ω –í–æ–∏–Ω, –∏ —Ç.–¥.)
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Ä–∞–Ω–∂–µ–≤—ã–º —Ü–≤–µ—Ç–æ–º

2. **–ú–∞–≥–∏—á–µ—Å–∫–∏–π —É—Ä–æ–Ω** (`"magic"`):
   - –í—Ä–∞–≥–∏-–º–∞–≥–∏ (–ì–æ–±–ª–∏–Ω –ö–æ–ª–¥—É–Ω, –ü—Ä–æ–∫–ª—è—Ç—ã–π –î–µ–º–æ–Ω, –∏ —Ç.–¥.)
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≥–æ–ª—É–±—ã–º —Ü–≤–µ—Ç–æ–º
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ–º: `intelligence >= agility AND intelligence >= strength`

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ü–∏—Ñ—Ä—ã —É—Ä–æ–Ω–∞ –¥–ª—è:
- ‚úÖ –ë–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –∏–≥—Ä–æ–∫–∞ (—É–∂–µ –±—ã–ª–æ)
- ‚úÖ –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –≤—Ä–∞–≥–æ–≤ (—É–∂–µ –±—ã–ª–æ)
- ‚úÖ **–ë–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –≤—Ä–∞–≥–æ–≤** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- ‚úÖ **–ü—Ä–æ–º–∞—Ö–æ–≤ –±–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –≤—Ä–∞–≥–æ–≤** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- ‚úÖ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–¥–∞—Ä–æ–≤ –±–∞–∑–æ–≤—ã—Ö –∞—Ç–∞–∫ –≤—Ä–∞–≥–æ–≤** (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

**–ì–æ–±–ª–∏–Ω –í–æ—Ä –∞—Ç–∞–∫—É–µ—Ç:**
1. –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–µ ‚Üí –¥–µ–ª–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∞—Ç–∞–∫—É
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–ø–∞–¥–∞–Ω–∏–µ
3. –ï—Å–ª–∏ –ø–æ–ø–∞–ª:
   - –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è –∑–≤—É–∫ `sword_attack1.wav`
   - –ù–∞–Ω–æ—Å–∏—Ç—Å—è —É—Ä–æ–Ω –∏–≥—Ä–æ–∫—É
   - **–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Ä–∞–Ω–∂–µ–≤–∞—è —Ü–∏—Ñ—Ä–∞ —É—Ä–æ–Ω–∞ –Ω–∞–¥ –∏–≥—Ä–æ–∫–æ–º** ‚¨ÖÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
4. –ï—Å–ª–∏ –ø—Ä–æ–º–∞—Ö:
   - **–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–ü–†–û–ú–ê–•!" –Ω–∞–¥ –∏–≥—Ä–æ–∫–æ–º** ‚¨ÖÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ì–æ–±–ª–∏–Ω –ö–æ–ª–¥—É–Ω –∞—Ç–∞–∫—É–µ—Ç (–º–∞–≥–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞):**
1. –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–µ ‚Üí –¥–µ–ª–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∞—Ç–∞–∫—É
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–ø–∞–¥–∞–Ω–∏–µ
3. –ï—Å–ª–∏ –ø–æ–ø–∞–ª:
   - –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è –∑–≤—É–∫ `magic_attack1.wav`
   - –ù–∞–Ω–æ—Å–∏—Ç—Å—è —É—Ä–æ–Ω –∏–≥—Ä–æ–∫—É
   - **–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≥–æ–ª—É–±–∞—è —Ü–∏—Ñ—Ä–∞ —É—Ä–æ–Ω–∞ –Ω–∞–¥ –∏–≥—Ä–æ–∫–æ–º** ‚¨ÖÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `Scripts/Battle/battle_manager.gd` - –¥–æ–±–∞–≤–ª–µ–Ω–æ 2 –≤—ã–∑–æ–≤–∞ `DamageNumberManager.show_damage_on_character()`
- `DAMAGE_NUMBERS_IMPROVEMENTS.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –°—Ç–∞—Ç—É—Å
üü¢ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** - –í—Å–µ —Ü–∏—Ñ—Ä—ã —É—Ä–æ–Ω–∞ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `DAMAGE_NUMBERS_IMPROVEMENTS.md` - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —É—Ä–æ–Ω–∞
- `DAMAGE_NUMBERS_SYSTEM.md` - —Å–∏—Å—Ç–µ–º–∞ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö —Ü–∏—Ñ—Ä —É—Ä–æ–Ω–∞
- `GOBLIN_THIEF_SOUND_UPDATE.md` - –∑–≤—É–∫–∏ –¥–ª—è –ì–æ–±–ª–∏–Ω–∞ –í–æ—Ä–∞

