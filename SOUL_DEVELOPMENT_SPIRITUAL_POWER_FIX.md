# Исправление доступности способностей духовной мощи

## Дата
28 октября 2025

## Проблема
Первая способность "Духовная мощь I" (Common) была недоступна для изучения, показывая сообщение "Сначала изучите предыдущую способность", хотя должна быть доступна сразу.

## Причина
ID способностей духовной мощи имеют формат `"spiritual_power_upgrade_X"`, а функция проверки последовательности искала `"soul_spiritual_power_X"`.

**Фактические ID:**
- `spiritual_power_upgrade_1`
- `spiritual_power_upgrade_2`
- `spiritual_power_upgrade_3`
- `spiritual_power_upgrade_4`
- `spiritual_power_upgrade_5`

**Что искалось в коде:** `"soul_spiritual_power"`

## Решение
Исправлен ID в функции `_check_previous_soul_ability_learned()` в `Scripts/UI/AbilityLearningScreen.gd`:

```gdscript
// Было:
elif "soul_spiritual_power" in ability_id:
    ability_type = "soul_spiritual_power"
    ability_number = int(ability_id.replace("soul_spiritual_power_", ""))

// Стало:
elif "spiritual_power_upgrade" in ability_id:
    ability_type = "spiritual_power_upgrade"
    ability_number = int(ability_id.replace("spiritual_power_upgrade_", ""))
```

## Что изменилось

### До исправления:
- ❌ Все 5 способностей духовной мощи были недоступны
- ❌ Показывалось сообщение "Сначала изучите предыдущую способность"
- ❌ Даже первая способность (уровень 1) была заблокирована

### После исправления:
- ✅ Первая способность (Духовная мощь I) доступна сразу
- ✅ Следующие способности доступны после изучения предыдущих
- ✅ Последовательность работает корректно

## Все ID способностей развития души

### Эффективность восстановления (6 уровней):
- `soul_restoration_efficiency_1` до `soul_restoration_efficiency_6`

### Заряды восстановления (6 уровней):
- `soul_restoration_charges_1` до `soul_restoration_charges_6`

### Барьер восстановления (6 уровней):
- `soul_restoration_barrier_1` до `soul_restoration_barrier_6`

### Духовная мощь (5 уровней):
- `spiritual_power_upgrade_1` до `spiritual_power_upgrade_5`
- ⚠️ **Обратите внимание**: НЕТ префикса "soul_"!

## Изменения в файлах

### Scripts/UI/AbilityLearningScreen.gd
**Функция**: `_check_previous_soul_ability_learned()`

**Изменено**:
- Условие проверки ID изменено с `"soul_spiritual_power"` на `"spiritual_power_upgrade"`
- Замена строки изменена с `soul_spiritual_power_` на `spiritual_power_upgrade_`

## Тестирование

### Тест 1: Доступность первой способности
1. Открыть экран изучения способностей
2. Перейти на вкладку "Развитие души"
3. Прокрутить до раздела "Усиление души"
4. **Результат**: "Духовная мощь I" (Common) должна быть доступна для изучения ✅

### Тест 2: Последовательность изучения
1. Изучить "Духовная мощь I"
2. Проверить доступность "Духовная мощь II"
3. **Результат**: Вторая способность должна стать доступной ✅
4. Проверить "Духовная мощь III"
5. **Результат**: Третья должна быть недоступна (требует II) ✅

### Тест 3: Независимость цепочек
1. Изучить "Духовная мощь I"
2. Проверить доступность способностей восстановления души
3. **Результат**: Способности восстановления должны быть независимы ✅

## Результат
✅ Первая способность "Духовная мощь I" теперь доступна для изучения
✅ Последовательность изучения работает корректно
✅ Все цепочки способностей работают независимо
✅ ID способностей правильно распознаются

## Для пользователя
Теперь вы можете изучать способности духовной мощи! Начните с "Духовная мощь I" (стоимость 50 ОД), которая увеличит вашу максимальную духовную мощь на 1.

