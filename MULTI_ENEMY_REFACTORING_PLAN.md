# –ü–ª–∞–Ω –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º—ã –±–æ—è –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤

## üìã –û–±–∑–æ—Ä

–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–æ—è —Å 1 –≤—Ä–∞–≥–æ–º –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–æ 3 –≤—Ä–∞–≥–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### **1. Battle Manager (battle_manager.gd)**

#### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```gdscript
# –ë—ã–ª–æ:
var enemy_node: Node2D

# –°—Ç–∞–Ω–µ—Ç:
var enemy_nodes: Array[Node2D] = []  # –ú–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤
var current_enemy_turn_index: int = 0  # –ò–Ω–¥–µ–∫—Å –≤—Ä–∞–≥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç
var selected_target_index: int = 0  # –í—ã–±—Ä–∞–Ω–Ω–∞—è —Ü–µ–ª—å –¥–ª—è –∞—Ç–∞–∫–∏ –∏–≥—Ä–æ–∫–∞
```

#### **–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. `_spawn_enemies()` - —Å–ø–∞–≤–Ω 1-3 –≤—Ä–∞–≥–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
2. `_enemy_action()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–¥–∞ –û–î–ù–û–ì–û –≤—Ä–∞–≥–∞, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
3. `_set_enemy_turn()` - –∑–∞–ø—É—Å–∫ —Ö–æ–¥–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—Ä–∞–≥–∞ –≤ –º–∞—Å—Å–∏–≤–µ
4. `player_attack()` - –∞—Ç–∞–∫–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
5. `_use_player_ability()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É–º–µ–Ω–∏—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
6. `_handle_enemy_ability()` - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–≤—Ä–∞–≥–∏ –∞—Ç–∞–∫—É—é—Ç –∏–≥—Ä–æ–∫–∞)
7. `_check_battle_end()` - –ø—Ä–æ–≤–µ—Ä–∫–∞, –≤—Å–µ –ª–∏ –≤—Ä–∞–≥–∏ –º–µ—Ä—Ç–≤—ã
8. `_award_rewards()` - –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –í–°–ï–• –≤—Ä–∞–≥–æ–≤
9. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å `enemy_node` ‚Üí `enemy_nodes[index]`

#### **–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `get_alive_enemies() -> Array[Node2D]` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∂–∏–≤—ã—Ö –≤—Ä–∞–≥–æ–≤
- `get_enemy_count() -> int` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–∞–≥–æ–≤
- `get_current_target() -> Node2D` - —Ç–µ–∫—É—â–∞—è –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Ü–µ–ª—å
- `select_next_target()` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ü–µ–ª–∏ –≤–ø—Ä–∞–≤–æ
- `select_previous_target()` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ü–µ–ª–∏ –≤–ª–µ–≤–æ

---

### **2. UI Controller (ui_controller.gd)**

#### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```gdscript
# –ë—ã–ª–æ:
@onready var enemy = get_node_or_null("/root/BattleScene/GameWorld/EnemyContainer").get_child(0)

# –°—Ç–∞–Ω–µ—Ç:
var enemies: Array[Node2D] = []
var selected_enemy_index: int = 0
```

#### **–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. `_update_ui()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –¥–ª—è –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤
2. `_update_enemy_overhead_ui()` - —Å–æ–∑–¥–∞–Ω–∏–µ UI –Ω–∞–¥ –ö–ê–ñ–î–´–ú –≤—Ä–∞–≥–æ–º
3. `_update_defensive_stats_display()` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤
4. `_update_enemy_passives_button()` - –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ "–£–º–µ–Ω–∏—è –≤—Ä–∞–≥–æ–≤"
5. `_show_enemy_abilities_dialog()` - –¥–∏–∞–ª–æ–≥ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–∞–≥–∞

#### **–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `_create_target_selection_ui()` - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞–¥ –≤—Ä–∞–≥–∞–º–∏ (—Å—Ç—Ä–µ–ª–∫–∏)
- `_highlight_selected_target(index: int)` - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ü–µ–ª–∏
- `_create_enemy_tabs_dialog()` - –¥–∏–∞–ª–æ–≥ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–∞–≥–∞

---

### **3. Enemy Spawner (enemy_spawner.gd)**

#### **–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```gdscript
func spawn_enemies(count: int, is_boss_room: bool, difficulty: int) -> Array[Node2D]:
	var spawned_enemies: Array[Node2D] = []
	
	# –ü–æ–ª—É—á–∞–µ–º —Å–ø–æ—Ç—ã –¥–ª—è –≤—Ä–∞–≥–æ–≤
	var spots = [
		enemy_container.get_node("EnemySpot1"),
		enemy_container.get_node("EnemySpot2"),
		enemy_container.get_node("EnemySpot3")
	]
	
	for i in range(min(count, 3)):
		var enemy = spawn_random_enemy()
		enemy.position = spots[i].position
		spawned_enemies.append(enemy)
	
	# –ï—Å–ª–∏ —ç—Ç–æ –±–æ—Å—Å-–∫–æ–º–Ω–∞—Ç–∞, –ø–µ—Ä–≤—ã–π –≤—Ä–∞–≥ - –±–æ—Å—Å
	if is_boss_room:
		spawned_enemies[0] = spawn_boss()
		# –°–ø—É—Ç–Ω–∏–∫–∏ –±–æ—Å—Å–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
		if difficulty >= 2:
			spawned_enemies.append(spawn_companion())
		if difficulty >= 3:
			spawned_enemies.append(spawn_companion())
	
	return spawned_enemies

func spawn_companion() -> Node2D:
	# –°–ø—É—Ç–Ω–∏–∫ –±–æ—Å—Å–∞: —Ä–µ–¥–∫–æ—Å—Ç—å –æ—Ç rare –¥–æ legendary
	var rarities = ["rare", "epic", "legendary"]
	var rarity = rarities[randi() % rarities.size()]
	return spawn_random_enemy_with_rarity(rarity)
```

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Å–ø–∞–≤–Ω–∞ –≤—Ä–∞–≥–æ–≤

### **–ü–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ª–æ–∫–∞—Ü–∏–∏:**

#### **–£—Ä–æ–≤–µ–Ω—å 1 (–õ–µ–≥–∫–æ):**
- **70%** - 1 –≤—Ä–∞–≥
- **30%** - 2 –≤—Ä–∞–≥–∞
- **–ë–æ—Å—Å** - 1 –±–æ—Å—Å (–±–µ–∑ —Å–ø—É—Ç–Ω–∏–∫–æ–≤)

#### **–£—Ä–æ–≤–µ–Ω—å 2 (–°—Ä–µ–¥–Ω–µ):**
- **20%** - 1 –≤—Ä–∞–≥
- **60%** - 2 –≤—Ä–∞–≥–∞
- **20%** - 3 –≤—Ä–∞–≥–∞
- **–ë–æ—Å—Å** - –±–æ—Å—Å + 1 —Å–ø—É—Ç–Ω–∏–∫ (rare-legendary)

#### **–£—Ä–æ–≤–µ–Ω—å 3 (–°–ª–æ–∂–Ω–æ):**
- **10%** - 1 –≤—Ä–∞–≥
- **20%** - 2 –≤—Ä–∞–≥–∞
- **70%** - 3 –≤—Ä–∞–≥–∞
- **–ë–æ—Å—Å** - –±–æ—Å—Å + 2 —Å–ø—É—Ç–Ω–∏–∫–∞ (rare-legendary)

---

## üéÆ –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏

### **UI —ç–ª–µ–º–µ–Ω—Ç—ã:**
1. **–°—Ç—Ä–µ–ª–∫–∏ –Ω–∞–¥ –≤—Ä–∞–≥–∞–º–∏** - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ü–µ–ª—å
2. **–ö–Ω–æ–ø–∫–∏ < >** - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ü–µ–ª—è–º–∏
3. **–ö–ª–∏–∫ –ø–æ –≤—Ä–∞–≥—É** - –≤—ã–±–æ—Ä —Ü–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. **–ü–æ–¥—Å–≤–µ—Ç–∫–∞** - –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤—Ä–∞–≥–∞

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- **Q / ‚Üê** - –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ü–µ–ª—å
- **E / ‚Üí** - —Å–ª–µ–¥—É—é—â–∞—è —Ü–µ–ª—å
- **–¶–∏—Ñ—Ä—ã 1-3** - –±—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä —Ü–µ–ª–∏
- **–ö–ª–∏–∫ –º—ã—à—å—é** - –≤—ã–±–æ—Ä —Ü–µ–ª–∏

---

## üìä –û—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å —Ö–æ–¥–æ–≤

### **–ü–æ—Ä—è–¥–æ–∫:**
1. **–•–æ–¥ –∏–≥—Ä–æ–∫–∞** - –∞—Ç–∞–∫–∞/—É–º–µ–Ω–∏–µ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
2. **–•–æ–¥ –≤—Ä–∞–≥–∞ 1** - –µ—Å–ª–∏ –∂–∏–≤
3. **–•–æ–¥ –≤—Ä–∞–≥–∞ 2** - –µ—Å–ª–∏ –∂–∏–≤
4. **–•–æ–¥ –≤—Ä–∞–≥–∞ 3** - –µ—Å–ª–∏ –∂–∏–≤
5. **–ü–æ–≤—Ç–æ—Ä–∏—Ç—å**

### **–õ–æ–≥–∏–∫–∞:**
- –ú–µ—Ä—Ç–≤—ã–µ –≤—Ä–∞–≥–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç —Ö–æ–¥
- –ï—Å–ª–∏ –≤—Å–µ –≤—Ä–∞–≥–∏ –º–µ—Ä—Ç–≤—ã - –ø–æ–±–µ–¥–∞
- –ö–∞–∂–¥—ã–π –≤—Ä–∞–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–∏ —É–º–µ–Ω–∏—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

---

## üé® UI –∏–∑–º–µ–Ω–µ–Ω–∏—è

### **–ù–∞–¥ –∫–∞–∂–¥—ã–º –≤—Ä–∞–≥–æ–º:**
- –ò–º—è (—Ü–≤–µ—Ç –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏)
- HP –±–∞—Ä —Å —Ü–∏—Ñ—Ä–∞–º–∏
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞—â–∏—Ç—ã/–º–∞–≥—Ä–µ–∑–∏—Å—Ç–∞
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—ã–±–æ—Ä–∞ (—Å—Ç—Ä–µ–ª–∫–∞)

### **–ö–Ω–æ–ø–∫–∞ "–£–º–µ–Ω–∏—è –≤—Ä–∞–≥–æ–≤":**
- –î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ (TabContainer)
- –ö–∞–∂–¥–∞—è –≤–∫–ª–∞–¥–∫–∞ - –æ–¥–∏–Ω –≤—Ä–∞–≥
- –í –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–µ:
  - –ê–∫—Ç–∏–≤–Ω–æ–µ —É–º–µ–Ω–∏–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –∫—É–ª–¥–∞—É–Ω)
  - –°–ø–∏—Å–æ–∫ –ø–∞—Å—Å–∏–≤–Ω—ã—Ö —É–º–µ–Ω–∏–π
  - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤—Ä–∞–≥–∞

---

## üêõ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - 3 UI –Ω–∞–¥ –≤—Ä–∞–≥–∞–º–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä
   - **–†–µ—à–µ–Ω–∏–µ:** –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ HP
   
2. **Collision detection** - —Å–ø—Ä–∞–π—Ç—ã –≤—Ä–∞–≥–æ–≤ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è
   - **–†–µ—à–µ–Ω–∏–µ:** –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–æ—Ç–æ–≤

3. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –∏–≥—Ä–æ–∫–∞** - 3 –≤—Ä–∞–≥–∞ —Å—Ä–∞–∑—É –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ
   - **–†–µ—à–µ–Ω–∏–µ:** –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä–∞–¥ –∏ –æ–ø—ã—Ç–∞

4. **–ê–Ω–∏–º–∞—Ü–∏–∏** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Ä–∞–≥–æ–≤ –∞—Ç–∞–∫—É—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - **–†–µ—à–µ–Ω–∏–µ:** –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–¥–æ–≤

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [x] 1. –°–æ–∑–¥–∞—Ç—å 3 —Å–ø–æ—Ç–∞ –¥–ª—è –≤—Ä–∞–≥–æ–≤ –≤ BattleScene.tscn
- [ ] 2. –ò–∑–º–µ–Ω–∏—Ç—å battle_manager - –º–∞—Å—Å–∏–≤ –≤—Ä–∞–≥–æ–≤
- [ ] 3. –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏
- [ ] 4. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å UI - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—Ä–∞–≥–æ–≤
- [ ] 5. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å —Ö–æ–¥ –≤—Ä–∞–≥–æ–≤ - –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ
- [ ] 6. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –æ–∫–Ω–æ —É–º–µ–Ω–∏–π - –≤–∫–ª–∞–¥–∫–∏
- [ ] 7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–ø–∞–≤–Ω–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- [ ] 8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–æ—Å—Å–æ–≤ —Å–æ —Å–ø—É—Ç–Ω–∏–∫–∞–º–∏
- [ ] 9. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 22.11.2025*

