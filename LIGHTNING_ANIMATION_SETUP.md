# Настройка анимации молнии в редакторе Godot

## Дата
28 октября 2025

## Что создано

### 1. SpriteFrames ресурс
**Файл:** `Assets/Sprites/Effects/Magic_Eff/2 Lightning bolt/LightningBolt_Frames.tres`

Содержит покадровую анимацию молнии из spritesheet:
- 8 кадров анимации (192x192 каждый)
- Скорость: 12 FPS
- Без цикла (проигрывается один раз)
- Название анимации: "lightning"

### 2. Сцена эффекта
**Файл:** `Scenes/Effects/LightningEffect.tscn`

Готовая сцена с AnimatedSprite2D:
- Подключен SpriteFrames ресурс
- Прикреплен скрипт `LightningEffectAnimated.gd`
- Настроены параметры эффекта

### 3. Скрипт анимации
**Файл:** `Scripts/Battle/LightningEffectAnimated.gd`

Управляет появлением, проигрыванием и исчезновением эффекта.

## Как настроить в редакторе Godot

### Шаг 1: Откройте SpriteFrames ресурс

1. В Godot откройте файл:
   ```
   Assets/Sprites/Effects/Magic_Eff/2 Lightning bolt/LightningBolt_Frames.tres
   ```

2. В панели **SpriteFrames** внизу экрана вы увидите:
   - Анимацию "lightning" с 8 кадрами
   - Каждый кадр из spritesheet `Lightning-bolt.png`

### Шаг 2: Настройте разбивку кадров (если нужно)

Если кадры отображаются неправильно, проверьте настройки Atlas:

**Для каждого кадра (AtlasTexture_frame0 - frame7):**

| Кадр | Region X | Region Y | Ширина | Высота |
|------|----------|----------|---------|---------|
| 0    | 0        | 0        | 192     | 192     |
| 1    | 192      | 0        | 192     | 192     |
| 2    | 384      | 0        | 192     | 192     |
| 3    | 576      | 0        | 192     | 192     |
| 4    | 0        | 192      | 192     | 192     |
| 5    | 192      | 192      | 192     | 192     |
| 6    | 384      | 192      | 192     | 192     |
| 7    | 576      | 192      | 192     | 192     |

**Визуально spritesheet выглядит так:**
```
┌─────┬─────┬─────┬─────┐
│  0  │  1  │  2  │  3  │
├─────┼─────┼─────┼─────┤
│  4  │  5  │  6  │  7  │
└─────┴─────┴─────┴─────┘
```

### Шаг 3: Настройте скорость анимации

В SpriteFrames ресурсе:
1. Выберите анимацию "lightning"
2. В правой панели измените **Speed (FPS)**:
   - Медленнее: 8-10 FPS (более плавная молния)
   - Нормально: 12 FPS (по умолчанию)
   - Быстрее: 15-20 FPS (резкая молния)

### Шаг 4: Настройте сцену эффекта

1. Откройте сцену:
   ```
   Scenes/Effects/LightningEffect.tscn
   ```

2. Выберите узел **LightningEffect** (AnimatedSprite2D)

3. В инспекторе доступны параметры скрипта:

#### Параметры эффекта:
```
Fade Duration: 0.2       # Длительность исчезновения (секунды)
Scale Start: 1.0         # Начальный размер (1.0 = 100%)
Scale End: 2.0           # Конечный размер (2.0 = 200%)
Sound Volume Db: 0.0     # Громкость звука молнии (-80 до 24)
Sound Pitch: 1.0         # Высота звука (0.5 до 2.0)
```

#### Настройка AnimatedSprite2D:
```
Sprite Frames: [LightningBolt_Frames.tres]
Animation: "lightning"
Texture Filter: Nearest   # Для пиксельной графики
```

### Шаг 5: Протестируйте эффект

**В редакторе:**
1. Запустите сцену `LightningEffect.tscn` (F6)
2. Эффект должен:
   - Появиться с увеличением
   - Проиграть анимацию молнии
   - Мерцать во время анимации
   - Исчезнуть с увеличением размера
   - Автоматически удалиться

**В игре:**
1. Изучите пассивку "Шаман бурь"
2. Используйте магические атаки
3. При срабатывании (5-15% шанс) молния ударит по цели

## Настройка внешнего вида

### Изменение цвета молнии

В скрипте `LightningEffectAnimated.gd` найдите:
```gdscript
func _ready():
    # ...
    modulate = Color(1.5, 1.5, 1.8, 0.0)  # Светло-голубой
```

**Варианты цветов:**
```gdscript
# Электрический синий
modulate = Color(0.3, 0.7, 1.5, 0.0)

# Фиолетовая молния
modulate = Color(1.3, 0.8, 1.8, 0.0)

# Желтая молния
modulate = Color(1.8, 1.8, 0.5, 0.0)

# Красная молния (огненная)
modulate = Color(1.8, 0.5, 0.5, 0.0)

# Зеленая молния (ядовитая)
modulate = Color(0.5, 1.8, 0.5, 0.0)
```

### Изменение размера молнии

В сцене `LightningEffect.tscn`:
1. Выберите узел LightningEffect
2. Измените параметры:
   ```
   Scale Start: 0.5    # Для маленькой молнии (в 2 раза меньше)
   Scale End: 1.0
   ```
   или
   ```
   Scale Start: 1.5    # Для огромной молнии (в 1.5 раза больше)
   Scale End: 3.0
   ```
   
**По умолчанию (текущие значения):**
   ```
   Scale Start: 1.0    # Стандартный размер (в 2 раза больше исходного)
   Scale End: 2.0
   ```

### Изменение позиции молнии

В скрипте `LightningEffectAnimated.gd`:
```gdscript
func setup(target_position: Vector2):
    # Меняем смещение по Y (выше/ниже)
    global_position = target_position + Vector2(0, -100)  # -100 = выше
    
    # Можно изменить на:
    global_position = target_position + Vector2(0, -150)  # Еще выше
    global_position = target_position + Vector2(0, -50)   # Ближе к цели
    global_position = target_position + Vector2(0, 0)     # Прямо на цели
```

### Изменение мерцания

В скрипте найдите цикл мерцания:
```gdscript
while is_playing():
    var pulse_tween = create_tween()
    # Яркая вспышка - измените яркость
    pulse_tween.tween_property(self, "modulate", Color(2.0, 2.0, 2.5, 1.0), 0.05)
    # ↑ Увеличьте значения для более яркой вспышки
```

**Варианты мерцания:**
```gdscript
# Сильное мерцание
Color(3.0, 3.0, 3.5, 1.0)  # Очень яркая вспышка

# Слабое мерцание
Color(1.5, 1.5, 1.8, 1.0)  # Мягкая вспышка

# Без мерцания (закомментируйте весь while блок)
```

## Альтернативные анимации

Если у вас есть другие spritesheet молнии:

### Для горизонтальной молнии (4x2):
```gdscript
region = Rect2(frame_x * frame_width, frame_y * frame_height, frame_width, frame_height)
```

### Для вертикальной молнии (2x4):
```gdscript
# Настройте регионы соответственно
```

## Создание вариаций эффекта

### Вариант 1: Быстрая молния
```
Speed (FPS): 20
Scale Start: 0.7
Scale End: 1.5
Fade Duration: 0.1
Sound Pitch: 1.3
```

### Вариант 2: Мощная молния (по умолчанию)
```
Speed (FPS): 12
Scale Start: 1.0
Scale End: 2.0
Fade Duration: 0.2
Sound Volume Db: 3.0
Sound Pitch: 0.8
+ Увеличить яркость мерцания
```

### Вариант 3: Слабая молния
```
Speed (FPS): 15
Scale Start: 0.5
Scale End: 1.0
Fade Duration: 0.15
Sound Volume Db: -5.0
Sound Pitch: 1.2
+ Уменьшить яркость цвета
```

## Экспорт параметров в редактор

Можно добавить больше @export параметров в скрипт:

```gdscript
extends AnimatedSprite2D
class_name LightningEffectAnimated

@export var fade_duration: float = 0.2
@export var scale_start: float = 0.5
@export var scale_end: float = 1.0
@export var offset_y: float = -100.0        # Новый параметр
@export var random_offset_max: float = 15.0 # Новый параметр
@export var flash_brightness: float = 2.0   # Новый параметр
@export_color_no_alpha var tint_color: Color = Color(1.5, 1.5, 1.8) # Новый параметр
```

Тогда все эти параметры можно будет настроить прямо в редакторе!

## Добавление звука

✅ **Звук уже добавлен!**

Звук удара молнии (`Thunder_bolt.wav`) автоматически проигрывается при появлении эффекта.

### Настройка звука в редакторе:

1. Откройте `LightningEffect.tscn`
2. Выберите узел `LightningEffect`
3. В инспекторе найдите параметры:
   - **Sound Volume Db** (0.0) - громкость (-80 до 24 dB)
   - **Sound Pitch** (1.0) - высота звука (0.5 до 2.0)

### Примеры настроек:

**Мощный удар:**
```
Sound Volume Db: 3.0  (громче)
Sound Pitch: 0.8       (ниже, более глубокий)
```

**Слабый удар:**
```
Sound Volume Db: -5.0  (тише)
Sound Pitch: 1.2       (выше, более резкий)
```

**Отключить звук:**
```
Sound Volume Db: -80.0
```

Подробнее см. **`LIGHTNING_SOUND_INTEGRATION.md`**

## Проверка корректности

### Чеклист:
- ✅ SpriteFrames содержит 10 кадров анимации (72x72 каждый)
- ✅ Все кадры правильно нарезаны из spritesheet
- ✅ Анимация "lightning" настроена и не зациклена
- ✅ Сцена LightningEffect корректно загружается
- ✅ Скрипт прикреплен к AnimatedSprite2D
- ✅ Эффект автоматически удаляется после завершения
- ✅ Пассивка "Шаман бурь" создает эффект при срабатывании
- ✅ Звук молнии проигрывается при появлении эффекта

## Полезные советы

### 1. Предпросмотр в редакторе
- Откройте `LightningEffect.tscn`
- Нажмите кнопку Play Animation внизу
- Посмотрите как выглядит анимация

### 2. Настройка без перезапуска игры
- Измените параметры в `.tscn` файле
- Сохраните (Ctrl+S)
- Новые параметры применятся в следующем срабатывании

### 3. Множественные варианты
Можно создать несколько сцен эффектов:
- `LightningEffect_Weak.tscn` - слабая молния
- `LightningEffect_Strong.tscn` - мощная молния
- `LightningEffect_Chain.tscn` - цепная молния

## Возможные проблемы и решения

### Проблема: Кадры анимации не отображаются
**Решение:**
1. Проверьте, что `Lightning-bolt.png` импортирован как текстура
2. Проверьте регионы AtlasTexture (см. таблицу выше)
3. Убедитесь, что размеры кадров правильные (192x192)

### Проблема: Анимация слишком быстрая/медленная
**Решение:**
1. Откройте `LightningBolt_Frames.tres`
2. Измените параметр `speed` в анимации
3. Значение в FPS (кадров в секунду)

### Проблема: Эффект не появляется в игре
**Решение:**
1. Проверьте, что пассивка "Шаман бурь" изучена
2. Проверьте логи на наличие ошибок загрузки сцены
3. Убедитесь, что используете магические атаки (не физические)

### Проблема: Молния в неправильном месте
**Решение:**
1. Измените `offset_y` в функции `setup()`
2. Проверьте `global_position` цели
3. Добавьте debug print для проверки координат

## Дополнительные ресурсы

### Если нужно изменить spritesheet:
1. Замените `Lightning-bolt.png` в папке
2. Обновите регионы в `LightningBolt_Frames.tres`
3. Проверьте количество кадров и их размеры

### Если нужно добавить вторую анимацию:
1. Откройте `LightningBolt_Frames.tres`
2. Добавьте новую анимацию (кнопка "New Animation")
3. Добавьте кадры в новую анимацию
4. Используйте в скрипте: `play("new_animation_name")`

## Результат
✅ Создана готовая сцена с покадровой анимацией молнии
✅ Все настраивается в редакторе Godot
✅ SpriteFrames ресурс готов к использованию
✅ Можно легко изменить цвет, размер, скорость
✅ Интегрировано с пассивкой "Шаман бурь"

