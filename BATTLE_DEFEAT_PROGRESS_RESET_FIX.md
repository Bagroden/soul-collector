# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–ë–†–û–°–ê –ü–†–û–ì–†–ï–°–°–ê –ü–†–ò –ü–û–†–ê–ñ–ï–ù–ò–ò

## ‚ùå **–ü–†–û–ë–õ–ï–ú–ê**

```
–°—Ü–µ–Ω–∞—Ä–∏–π:
1. –ò–≥—Ä–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç 4 —ç—Ç–∞–ø–∞ –ª–æ–∫–∞—Ü–∏–∏
2. –ü–æ–±–µ–∂–¥–∞–µ—Ç –≤—Ä–∞–≥–∞ –≤ –∫–≤–µ—Å—Ç–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç–µ
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –∫–æ–º–Ω–∞—Ç–µ –±–æ—Å—Å–∞
4. –ë–æ—Å—Å —É–±–∏–≤–∞–µ—Ç –∏–≥—Ä–æ–∫–∞
5. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –Ω–∞ –ª–æ–∫–∞—Ü–∏—é –∏–≥—Ä–æ–∫ —Å–Ω–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å –±–æ—Å—Å–∞

–ü—Ä–æ–±–ª–µ–º–∞:
‚ùå –ü—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–∫–∞—Ü–∏–∏ –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –ø—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏
‚ùå –ò–≥—Ä–æ–∫ –∑–∞—Å—Ç—Ä–µ–≤–∞–ª –Ω–∞ –±–æ—Å—Å–µ
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –ª–æ–∫–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ —Å –Ω–∞—á–∞–ª–∞
```

---

## ‚úÖ **–†–ï–®–ï–ù–ò–ï**

### **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è:**

**1. –§–∞–π–ª:** `Scripts/BattleResult.gd`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `has_result` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –±—ã–ª –ª–∏ –±–æ–π
- ‚úÖ –§–ª–∞–≥ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `true` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `set_battle_result()`
- ‚úÖ –§–ª–∞–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ `false` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `clear_result()`

**2. –§–∞–π–ª:** `Scripts/RoomSelector.gd`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_on_battle_defeat()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_check_battle_result()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏:
  - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–∫–∞—Ü–∏–∏
  - –¢–µ—Ä—è—é—Ç—Å—è –≤—Å–µ –æ—Å–∫–æ–ª–∫–∏ –¥—É—à –∑–∞ —Ç–µ–∫—É—â–∏–π –∑–∞–±–µ–≥
  - –ò–≥—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à

---

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø**

### **1. BattleResult.gd**

#### **–î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ has_result:**

```gdscript
// –ë–´–õ–û:
var last_enemy_level: int = 1
var last_enemy_rarity: String = "common"
var battle_won: bool = false

// –°–¢–ê–õ–û:
var last_enemy_level: int = 1
var last_enemy_rarity: String = "common"
var battle_won: bool = false
var has_result: bool = false  // ‚úÖ –ù–æ–≤—ã–π —Ñ–ª–∞–≥
```

---

#### **–û–±–Ω–æ–≤–ª–µ–Ω–∞ set_battle_result():**

```gdscript
func set_battle_result(enemy_level: int, enemy_rarity: String, won: bool):
	last_enemy_level = enemy_level
	last_enemy_rarity = enemy_rarity
	battle_won = won
	has_result = true  // ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
	print("BattleResult: –í—Ä–∞–≥ —É—Ä–æ–≤–µ–Ω—å ", enemy_level, ", –†–µ–¥–∫–æ—Å—Ç—å ", enemy_rarity, ", –ü–æ–±–µ–¥–∞ ", won)
```

---

#### **–û–±–Ω–æ–≤–ª–µ–Ω–∞ clear_result():**

```gdscript
func clear_result():
	last_enemy_level = 1
	last_enemy_rarity = "common"
	battle_won = false
	has_result = false  // ‚úÖ –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
```

---

### **2. RoomSelector.gd**

#### **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è _on_battle_defeat():**

```gdscript
func _on_battle_defeat():
	"""–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –≤ –±–æ—é - —Å–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à"""
	print("–ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª –±–æ–π. –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ª–æ–∫–∞—Ü–∏–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à...")
	
	// 1. –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–∫–∞—Ü–∏–∏
	if is_instance_valid(room_generator):
		room_generator.reset_location_progress()
		print("DEBUG: –ü—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–∫–∞—Ü–∏–∏ —Å–±—Ä–æ—à–µ–Ω")
	
	// 2. –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏
	var player_manager = get_node_or_null("/root/PlayerManager")
	if player_manager:
		player_manager.set_in_location(false)
	
	// 3. –¢–ï–†–Ø–ï–ú –æ—Å–∫–æ–ª–∫–∏ –¥—É—à –∑–∞ —Ç–µ–∫—É—â–∏–π –∑–∞–±–µ–≥
	var soul_shard_manager = get_node_or_null("/root/SoulShard")
	if soul_shard_manager:
		var lost_shards = soul_shard_manager.get_run_soul_shards()
		soul_shard_manager.reset_run_soul_shards()
		print("DEBUG: –ü–æ—Ç–µ—Ä—è–Ω–æ ", lost_shards, " –æ—Å–∫–æ–ª–∫–æ–≤ –¥—É—à –∑–∞ —ç—Ç–æ—Ç –∑–∞–±–µ–≥")
	
	// 4. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ä—è–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥—É—à–∏
	var soul_restoration_manager = get_node_or_null("/root/SoulRestorationManager")
	if soul_restoration_manager:
		soul_restoration_manager.restore_all_charges()
	
	// 5. –û—á–∏—â–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π RoomGenerator
	var global_room_generator = get_node_or_null("/root/RoomGenerator")
	if global_room_generator:
		global_room_generator.queue_free()
	
	// 6. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É
	if player_manager:
		player_manager.save_game_data()
	
	// 7. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —ç–∫—Ä–∞–Ω—É –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ (–ö–æ–ª–æ–¥–µ—Ü –¥—É—à)
	SceneTransition.change_scene("res://Scenes/UI/CharacterPreparation.tscn")
```

---

#### **–û–±–Ω–æ–≤–ª–µ–Ω–∞ _check_battle_result():**

```gdscript
// –ë–´–õ–û:
func _check_battle_result():
	var battle_result = get_node_or_null("/root/BattleResult")
	
	if battle_result:
		if battle_result.was_battle_won():
			_on_battle_completed()
			battle_result.clear_result()
		// ‚ùå –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ—Å—å

// –°–¢–ê–õ–û:
func _check_battle_result():
	var battle_result = get_node_or_null("/root/BattleResult")
	
	if battle_result and battle_result.has_result:  // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º has_result
		var was_won = battle_result.was_battle_won()
		
		if was_won:
			// –ü–æ–±–µ–¥–∞
			print("DEBUG: –ò–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–æ—è...")
			_on_battle_completed()
		else:
			// ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
			print("DEBUG: –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª –±–æ–π. –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ª–æ–∫–∞—Ü–∏–∏...")
			_on_battle_defeat()
		
		battle_result.clear_result()
```

---

## üìä **–°–†–ê–í–ù–ï–ù–ò–ï –ü–û–í–ï–î–ï–ù–ò–Ø**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```
–ò–≥—Ä–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç 4 —ç—Ç–∞–ø–∞:
1. –û–±—ã—á–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚úì
2. –û–±—ã—á–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚úì
3. –ö–æ–º–Ω–∞—Ç–∞ –æ—Ç–¥—ã—Ö–∞ ‚úì
4. –ö–≤–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚úì
5. –ë–û–°–° (–∫–æ–º–Ω–∞—Ç–∞ 5) ‚úó –ü–æ—Ä–∞–∂–µ–Ω–∏–µ

–í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ª–æ–∫–∞—Ü–∏—é:
‚ùå rooms_cleared = 4
‚ùå –°—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∫–æ–º–Ω–∞—Ç–∞ –±–æ—Å—Å–∞
‚ùå –ó–∞—Å—Ç—Ä—è–ª –Ω–∞ –±–æ—Å—Å–µ
‚ùå –ù—É–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Å –±–æ—Å—Å–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑
```

---

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```
–ò–≥—Ä–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç 4 —ç—Ç–∞–ø–∞:
1. –û–±—ã—á–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚úì
2. –û–±—ã—á–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚úì
3. –ö–æ–º–Ω–∞—Ç–∞ –æ—Ç–¥—ã—Ö–∞ ‚úì
4. –ö–≤–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚úì
5. –ë–û–°–° (–∫–æ–º–Ω–∞—Ç–∞ 5) ‚úó –ü–æ—Ä–∞–∂–µ–Ω–∏–µ

–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è:
‚úÖ room_generator.reset_location_progress()
‚úÖ rooms_cleared = 0
‚úÖ current_location = null
‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à

–í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –ª–æ–∫–∞—Ü–∏—é:
‚úÖ –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —ç—Ç–∞–ø–∞ 1
‚úÖ –ù–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
‚úÖ –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞ —Å –Ω–∞—á–∞–ª–∞
```

---

## üíÄ **–ü–û–°–õ–ï–î–°–¢–í–ò–Ø –ü–û–†–ê–ñ–ï–ù–ò–Ø**

### **1. –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:**
```
‚úÖ rooms_cleared = 0
‚úÖ –í—Å–µ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
‚úÖ –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1 —ç—Ç–∞–ø–∞
```

### **2. –ü–æ—Ç–µ—Ä—è –æ—Å–∫–æ–ª–∫–æ–≤ –¥—É—à:**
```
‚úÖ –û—Å–∫–æ–ª–∫–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π –∑–∞–±–µ–≥ —Ç–µ—Ä—è—é—Ç—Å—è
‚úÖ –û—Å–∫–æ–ª–∫–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ö–æ–ª–æ–¥–µ—Ü –¥—É—à) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
‚úÖ –ú–µ—Ö–∞–Ω–∏–∫–∞ —Ä–∏—Å–∫-–Ω–∞–≥—Ä–∞–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### **3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```
‚úÖ HP, MP, Stamina –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
‚úÖ –ó–∞—Ä—è–¥—ã "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥—É—à–∏" –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
‚úÖ –ò–≥—Ä–æ–∫ –≥–æ—Ç–æ–≤ –∫ –Ω–æ–≤–æ–º—É –∑–∞–±–µ–≥—É
```

### **4. –í–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à:**
```
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
‚úÖ –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
‚úÖ –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –ª–æ–∫–∞—Ü–∏—é
```

---

## üéÆ **–û–ü–´–¢ –ò–ì–†–û–ö–ê**

### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç –±–æ—Å—Å–∞**

```
–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –ò–≥—Ä–æ–∫ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –±–æ—Å—Å–∞
2. –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ –ª–æ–∫–∞—Ü–∏—é
4. ‚ùå –°–Ω–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å –±–æ—Å—Å–∞
5. ‚ùå –ó–∞—Å—Ç—Ä—è–ª –≤ —Ü–∏–∫–ª–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –ò–≥—Ä–æ–∫ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –±–æ—Å—Å–∞
2. –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç
3. ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
4. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à
5. ‚úÖ –ú–æ–∂–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
6. ‚úÖ –ù–∞—á–∏–Ω–∞–µ—Ç –ª–æ–∫–∞—Ü–∏—é —Å —ç—Ç–∞–ø–∞ 1
```

---

### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –≤—Ä–∞–≥–∞**

```
–ò–≥—Ä–æ–∫ –Ω–∞ —ç—Ç–∞–ø–µ 2:
1. –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –æ–±—ã—á–Ω–æ–º—É –≤—Ä–∞–≥—É
2. ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
3. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à
4. ‚úÖ –¢–µ—Ä—è–µ—Ç –æ—Å–∫–æ–ª–∫–∏ –∑–∞ —ç—Ç–æ—Ç –∑–∞–±–µ–≥
5. ‚úÖ –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å —ç—Ç–∞–ø–∞ 1
```

---

## üí° **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê**

### **1. –ß–µ—Å—Ç–Ω–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞:**
```
‚úÖ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–µ—Ç –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
‚úÖ –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –æ—Å–∫–æ–ª–∫–æ–≤
‚úÖ –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –±–æ–ª–µ–µ —Ü–µ–Ω–Ω–∞
```

### **2. –ë–∞–ª–∞–Ω—Å:**
```
‚úÖ –ò–≥—Ä–æ–∫ –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –Ω–∞ –±–æ—Å—Å–µ
‚úÖ –ú–æ–∂–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
‚úÖ –ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª—É—á—à–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```

### **3. –ú–æ—Ç–∏–≤–∞—Ü–∏—è:**
```
‚úÖ –í–∞–∂–Ω–æ –Ω–µ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å
‚úÖ –°—Ç–∏–º—É–ª –∏–≥—Ä–∞—Ç—å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ
‚úÖ –ö–∞–∂–¥—ã–π –∑–∞–±–µ–≥ –≤–∞–∂–µ–Ω
```

### **4. Roguelike –æ–ø—ã—Ç:**
```
‚úÖ –ö–∞–∂–¥—ã–π –∑–∞–±–µ–≥ —É–Ω–∏–∫–∞–ª–µ–Ω
‚úÖ –†–∏—Å–∫ –∏ –Ω–∞–≥—Ä–∞–¥–∞
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω
```

---

## üîç **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï**

### **–¢–µ—Å—Ç 1: –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç –±–æ—Å—Å–∞**
```
1. –ù–∞—á–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é
2. –ü—Ä–æ–π—Ç–∏ 4 —ç—Ç–∞–ø–∞
3. –î–æ–π—Ç–∏ –¥–æ –±–æ—Å—Å–∞
4. –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –±–æ—é

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω
‚úÖ –û—Å–∫–æ–ª–∫–∏ –∑–∞ –∑–∞–±–µ–≥ –ø–æ—Ç–µ—Ä—è–Ω—ã
‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à
‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏: "DEBUG: –ò–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª –±–æ–π. –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ª–æ–∫–∞—Ü–∏–∏..."
‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏: "DEBUG: –ü—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–∫–∞—Ü–∏–∏ —Å–±—Ä–æ—à–µ–Ω"
‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏: "DEBUG: –ü–æ—Ç–µ—Ä—è–Ω–æ X –æ—Å–∫–æ–ª–∫–æ–≤ –¥—É—à –∑–∞ —ç—Ç–æ—Ç –∑–∞–±–µ–≥"
```

---

### **–¢–µ—Å—Ç 2: –ü–æ—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –≤—Ä–∞–≥–∞**
```
1. –ù–∞—á–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é
2. –ü—Ä–æ–π—Ç–∏ 2 —ç—Ç–∞–ø–∞
3. –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ 3

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω (rooms_cleared = 0)
‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à
```

---

### **–¢–µ—Å—Ç 3: –í–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ –ø–æ—Ä–∞–∂–µ–Ω–∏—è**
```
1. –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –±–æ–π (–ª—é–±–æ–π)
2. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Ç—É –∂–µ –ª–æ–∫–∞—Ü–∏—é
3. –ù–∞—á–∞—Ç—å –∑–∞–±–µ–≥

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —ç—Ç–∞–ø–∞ 1
‚úÖ –ù–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
‚úÖ –ù–ï –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å –º–µ—Å—Ç–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
```

---

### **–¢–µ—Å—Ç 4: –û—Å–∫–æ–ª–∫–∏ –¥—É—à**
```
1. –°–æ–±—Ä–∞—Ç—å 50 –æ—Å–∫–æ–ª–∫–æ–≤ –∑–∞ –∑–∞–±–µ–≥
2. –ò–º–µ—Ç—å 100 –æ—Å–∫–æ–ª–∫–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
3. –ü—Ä–æ–∏–≥—Ä–∞—Ç—å –±–æ–π

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ü–æ—Ç–µ—Ä—è–Ω—ã 50 –æ—Å–∫–æ–ª–∫–æ–≤ –∑–∞ –∑–∞–±–µ–≥
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã 100 –æ—Å–∫–æ–ª–∫–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚úÖ –û–±—â–∏–π –±–∞–ª–∞–Ω—Å: 100 –æ—Å–∫–æ–ª–∫–æ–≤
```

---

## ‚ö†Ô∏è **–í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø**

### **1. –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥" –∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ–º:**

| –î–µ–π—Å—Ç–≤–∏–µ | "–ù–∞–∑–∞–¥" | –ü–æ—Ä–∞–∂–µ–Ω–∏–µ |
|----------|---------|-----------|
| –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω | ‚úÖ | ‚úÖ |
| –û—Å–∫–æ–ª–∫–∏ –∑–∞ –∑–∞–±–µ–≥ | ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã | ‚ùå –ü–æ—Ç–µ—Ä—è–Ω—ã |
| –í–æ–∑–≤—Ä–∞—Ç –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à | ‚úÖ | ‚úÖ |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã | ‚úÖ | ‚úÖ |

**–í—ã–≤–æ–¥:** –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Å–∫–æ–ª–∫–∏, –ø–æ—Ä–∞–∂–µ–Ω–∏–µ - —Ç–µ—Ä—è–µ—Ç –∏—Ö.

---

### **2. –§–ª–∞–≥ has_result:**
```
has_result = true  ‚Üí –ë—ã–ª –±–æ–π, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
has_result = false ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–µ—Ç –∏–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
```

**–í–∞–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `has_result` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–æ—è.

---

### **3. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
```
‚úÖ –°—Ç–∞—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: –†–∞–±–æ—Ç–∞—é—Ç (–ø—Ä–æ–≥—Ä–µ—Å—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è)
‚úÖ –ù–æ–≤—ã–µ –∏–≥—Ä—ã: –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
‚úÖ –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã
```

---

## ‚úÖ **–ò–¢–û–ì**

### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `has_result` –≤ `BattleResult.gd`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_on_battle_defeat()` –≤ `RoomSelector.gd`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_check_battle_result()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏–∏ —Ç–µ—Ä—è—é—Ç—Å—è –æ—Å–∫–æ–ª–∫–∏ –∑–∞ –∑–∞–±–µ–≥
- ‚úÖ –ò–≥—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ö–æ–ª–æ–¥–µ—Ü –¥—É—à

### **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ò–≥—Ä–æ–∫ –±–æ–ª—å—à–µ –ù–ï –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –Ω–∞ –±–æ—Å—Å–µ
- ‚úÖ –ö–∞–∂–¥—ã–π –∑–∞–±–µ–≥ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —ç—Ç–∞–ø–∞ 1
- ‚úÖ –ß–µ—Å—Ç–Ω–∞—è roguelike –º–µ—Ö–∞–Ω–∏–∫–∞
- ‚úÖ –ë–∞–ª–∞–Ω—Å —Ä–∏—Å–∫-–Ω–∞–≥—Ä–∞–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ linter

### **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `Scripts/BattleResult.gd` (–¥–æ–±–∞–≤–ª–µ–Ω `has_result`)
- ‚úÖ `Scripts/RoomSelector.gd` (–¥–æ–±–∞–≤–ª–µ–Ω–∞ `_on_battle_defeat()` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ `_check_battle_result()`)
- ‚úÖ `BATTLE_DEFEAT_PROGRESS_RESET_FIX.md` (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

---

**–ê–≤—Ç–æ—Ä:** Claude AI Assistant  
**–î–∞—Ç–∞:** 2024  
**–í–µ—Ä—Å–∏—è:** beta 0.6.11

