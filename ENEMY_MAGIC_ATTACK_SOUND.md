# Звук базовой магической атаки врагов

## Описание
Добавлен звуковой эффект для базовых магических атак врагов (например, когда Гоблин колдун атакует базовой магической атакой, пока способность "Магические стрелы" на перезарядке).

## Технические детали

### Файл звука
- **Путь**: `Audio/Sounds/magic_attack1.wav`
- **Использование**: Базовые магические атаки врагов

### Реализация

**Файл**: `Scripts/Battle/battle_manager.gd`

**Функция**: `_enemy_action()`

Звук проигрывается **только** внутри блока `if not ability_used:` (базовая атака), после проверки попадания:
```gdscript
# Внутри блока базовой атаки (if not ability_used:)
if not _calculate_hit_chance(enemy_node, player_node, "main_attack", "Базовая атака"):
    # ... обработка промаха ...
    return

# Проигрываем звук для магической базовой атаки врага
if damage_type == "magic":
    var audio_player = AudioStreamPlayer.new()
    audio_player.stream = load("res://Audio/Sounds/magic_attack1.wav")
    audio_player.volume_db = 0.0
    audio_player.bus = "Master"
    add_child(audio_player)
    audio_player.play()
    # Удаляем после проигрывания
    audio_player.finished.connect(func(): audio_player.queue_free())
```

## Когда звук проигрывается

Звук проигрывается когда:
1. Враг делает базовую атаку (не активную способность)
2. `damage_type` врага равен `"magic"`
3. Атака не промахнулась (прошла проверку на уворот)

## Примеры врагов с магическими атаками

- **Гоблин колдун** - базовая атака магическая
- **Проклятый демон** - базовая атака магическая
- Другие враги с `damage_type = "magic"`

## Важно

**НЕ** применяется к:
- Атакам игрока (Спиритический удар, Магические стрелы и т.д.)
- Активным способностям врагов (у них свои звуки)
- Физическим атакам врагов

## Исправленные ошибки

### Баг: Звук проигрывался для всех атак
**Проблема**: Изначально код звука находился вне блока `if not ability_used:`, что приводило к проигрыванию звука как для базовых атак, так и для активных способностей (например, звук проигрывался дважды при использовании "Магических стрел").

**Решение**: Код звука был перемещен внутрь блока `if not ability_used:`, чтобы звук проигрывался только для базовых магических атак врагов, а не для активных способностей.

Дата: 28 октября 2025

