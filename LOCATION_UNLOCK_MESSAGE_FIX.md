# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –Ω–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –Ω–∞–¥ –ì–Ω–∏–ª–æ—Å—Ç–Ω—ã–º —Å–ª–∏–∑–Ω–µ–º (–±–æ—Å—Å–æ–º –ø–æ–¥–∑–µ–º–µ–ª—å—è) –≤ –æ–∫–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è "–õ–µ—Å –≥–æ–±–ª–∏–Ω–æ–≤".

---

## üîç –ü—Ä–∏—á–∏–Ω–∞

–õ–æ–∫–∞—Ü–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞—Å—å **–¥–≤–∞–∂–¥—ã** –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:

### 1Ô∏è‚É£ –ü–µ—Ä–≤–æ–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ (battle_manager.gd):
```gdscript
# –ü–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –Ω–∞–¥ –±–æ—Å—Å–æ–º
if has_boss:
    var unlocked_location_name = location_manager.unlock_next_location_after_boss(current_location_id)
    if unlocked_location_name != "":
        _show_message("üó∫Ô∏è –ù–û–í–ê–Ø –õ–û–ö–ê–¶–ò–Ø –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê!\n\n" + unlocked_location_name + " —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è!", 5.0)
```

### 2Ô∏è‚É£ –í—Ç–æ—Ä–æ–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ (RoomSelector.gd):
```gdscript
func _on_location_completed():
    # ...
    if not next_location.is_unlocked:
        location_manager.unlock_location(next_location.location_id)
        was_unlocked_now = true  # ‚ö†Ô∏è –≠—Ç–æ—Ç —Ñ–ª–∞–≥ –≤—Å–µ–≥–¥–∞ –±—ã–ª false!
```

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞:

1. –í **battle_manager** –ª–æ–∫–∞—Ü–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `unlock_next_location_after_boss()`
2. –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –±–∞—Ç–ª–µ —á–µ—Ä–µ–∑ `_show_message()` (–±—ã—Å—Ç—Ä–æ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç)
3. –ó–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **RoomSelector._on_location_completed()**
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ `if not next_location.is_unlocked:` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`, —Ç–∞–∫ –∫–∞–∫ –ª–æ–∫–∞—Ü–∏—è –£–ñ–ï —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
5. `was_unlocked_now = false` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –æ–∫–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è!

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–£–±—Ä–∞–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è:

### –ë–´–õ–û (battle_manager.gd):
```gdscript
# –ï—Å–ª–∏ –ø–æ–±–µ–∂–¥–µ–Ω –±–æ—Å—Å –ª–æ–∫–∞—Ü–∏–∏ (–Ω–∞ –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏), —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â—É—é –ª–æ–∫–∞—Ü–∏—é
if has_boss:
    var unlocked_location_name = location_manager.unlock_next_location_after_boss(current_location_id)
    if unlocked_location_name != "":
        _show_message("üó∫Ô∏è –ù–û–í–ê–Ø –õ–û–ö–ê–¶–ò–Ø –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê!\n\n" + unlocked_location_name + " —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è!", 5.0)
```

### –°–¢–ê–õ–û (battle_manager.gd):
```gdscript
# –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –ª–æ–∫–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ RoomSelector._on_location_completed()
```

### –û—Å—Ç–∞–ª–æ—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (RoomSelector.gd):
```gdscript
func _on_location_completed():
    var next_location = location_manager.get_next_location(current_location)
    var was_unlocked_now = false
    
    if next_location:
        if not next_location.is_unlocked:
            location_manager.unlock_location(next_location.location_id)
            was_unlocked_now = true  # ‚úÖ –¢–µ–ø–µ—Ä—å —Ñ–ª–∞–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è!
            print("‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –Ω–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è: ", next_location.location_name)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
    await _show_location_completion_dialog(current_location, next_location, was_unlocked_now)
```

---

## üéØ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π:

1. –ò–≥—Ä–æ–∫ –ø–æ–±–µ–∂–¥–∞–µ—Ç –±–æ—Å—Å–∞ (–ì–Ω–∏–ª–æ—Å—Ç–Ω—ã–π —Å–ª–∏–∑–µ–Ω—å)
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã
3. –ò–≥—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ RoomSelector
4. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `_on_location_completed()`
5. **–õ–æ–∫–∞—Ü–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞)
6. `was_unlocked_now = true` ‚úÖ
7. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫—Ä–∞—Å–∏–≤–æ–µ –æ–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏
8. –í –æ–∫–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
‚öîÔ∏è –õ–û–ö–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê! ‚öîÔ∏è

–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ –ª–æ–∫–∞—Ü–∏—é:
–ü–æ–¥–∑–µ–º–µ–ª—å–µ –ø–æ–¥ –≥–æ—Ä–æ–¥–æ–º

üéâ –ù–û–í–ê–Ø –õ–û–ö–ê–¶–ò–Ø –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê! üéâ

–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–æ–∫–∞—Ü–∏—è:
–õ–µ—Å –≥–æ–±–ª–∏–Ω–æ–≤
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|--------|-----------|
| `Scripts/Battle/battle_manager.gd` | 4490-4494 | –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ |

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é –∏–≥—Ä—É**
2. **–ü—Ä–æ–π–¥–∏—Ç–µ –ø–æ–¥–∑–µ–º–µ–ª—å–µ** –¥–æ –±–æ—Å—Å–∞
3. **–ü–æ–±–µ–¥–∏—Ç–µ –ì–Ω–∏–ª–æ—Å—Ç–Ω–æ–≥–æ —Å–ª–∏–∑–Ω—è**
4. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —ç–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã
5. ‚úÖ –ü–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ RoomSelector –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –æ–∫–Ω–æ "–õ–û–ö–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!"
6. ‚úÖ –í –æ–∫–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
   ```
   üéâ –ù–û–í–ê–Ø –õ–û–ö–ê–¶–ò–Ø –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ê–ù–ê! üéâ
   
   –¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–æ–∫–∞—Ü–∏—è:
   –õ–µ—Å –≥–æ–±–ª–∏–Ω–æ–≤
   ```

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü–æ—á–µ–º—É —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ RoomSelector:

1. **RoomSelector** - —ç—Ç–æ UI —Å–ª–æ–π, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–≥—Ä–æ–∫—É
2. **battle_manager** - —ç—Ç–æ –ª–æ–≥–∏–∫–∞ –±–æ—è, –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ UI —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ª–æ–∫–∞—Ü–∏—è—Ö
3. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: –±–æ–π ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ—è ‚Üí UI –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
4. –û–∫–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ RoomSelector, –ª–æ–≥–∏—á–Ω–æ —Ç–∞–º –∂–µ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é

### –§—É–Ω–∫—Ü–∏—è unlock_next_location_after_boss:

–§—É–Ω–∫—Ü–∏—è `unlock_next_location_after_boss` –≤ `LocationManagerAutoload.gd` –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è. –ü—Ä–æ—Å—Ç–æ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `get_next_location()`, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `location_order`.

---

## üîÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

### –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ –ª–æ–∫–∞—Ü–∏–π:

```
–ü–æ–¥–∑–µ–º–µ–ª—å–µ (dungeon) 
  ‚Üì (–ø–æ–±–µ–¥–∞ –Ω–∞–¥ –±–æ—Å—Å–æ–º)
–õ–µ—Å –≥–æ–±–ª–∏–Ω–æ–≤ (forest)
  ‚Üì (–ø–æ–±–µ–¥–∞ –Ω–∞–¥ –±–æ—Å—Å–æ–º)
–ó–∞–±—Ä–æ—à–µ–Ω–Ω–æ–µ –∫–ª–∞–¥–±–∏—â–µ (cemetery)
  ‚Üì (–ø–æ–±–µ–¥–∞ –Ω–∞–¥ –±–æ—Å—Å–æ–º)
–¢—É–º–∞–Ω–Ω—ã–µ –±–æ–ª–æ—Ç–∞ (sinister_swamps)
  ‚Üì (–ø–æ–±–µ–¥–∞ –Ω–∞–¥ –±–æ—Å—Å–æ–º)
–î–µ–º–æ–Ω–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–æ–≤–æ (demon_lair)
```

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `Scripts/LocationManagerAutoload.gd` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–π –∏ –∏—Ö —Å–≤—è–∑–µ–π
- `Scripts/RoomSelector.gd` - UI –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π
- `Scripts/Battle/battle_manager.gd` - –ª–æ–≥–∏–∫–∞ –±–æ—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã –Ω–∞–¥ –±–æ—Å—Å–æ–º
- `Scripts/RoomGenerator.gd` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ `location_completed`

---

**–ê–≤—Ç–æ—Ä:** Claude AI Assistant  
**–î–∞—Ç–∞:** 2024  
**–í–µ—Ä—Å–∏—è:** 1.0 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è

