# Исправление ошибки тестовой арены

## Проблема
В тестовой арене при выборе конкретного врага (например, "Крыса") появляется другой враг (например, "AlkaraDemon").

## Анализ лога
```
Выбран враг: Крыса (common) ✅
Выбрана редкость: легендарный ✅
Начинаем тестовый бой с res://Scenes/Battle/Enemy_Rat.tscn (легендарный) ✅
НО появился AlkaraDemon ❌
```

## Причина
Проблема в том, что переменные `test_mode`, `test_enemy_scene` и `test_enemy_rarity` могут быть не установлены правильно или сбрасываться где-то в коде.

## Исправления

### 1. Добавлена отладка в `spawn_enemy()`
```gdscript
# ОТЛАДКА: Проверяем состояние тестового режима
print("=== ОТЛАДКА SPAWN_ENEMY ===")
print("test_mode: ", test_mode)
print("test_enemy_scene: ", test_enemy_scene)
print("test_enemy_rarity: ", test_enemy_rarity)
print("==========================")
```

### 2. Добавлена отладка в `_spawn_test_enemy()`
```gdscript
print("=== ОТЛАДКА _SPAWN_TEST_ENEMY ===")
print("test_mode: ", test_mode)
print("test_enemy_scene: ", test_enemy_scene)
print("test_enemy_rarity: ", test_enemy_rarity)
print("==================================")

if not test_mode or test_enemy_scene == "":
    print("ОШИБКА: test_mode = ", test_mode, ", test_enemy_scene = '", test_enemy_scene, "'")
    return
```

### 3. Добавлена отладка в `set_test_mode()`
```gdscript
print("=== ОТЛАДКА SET_TEST_MODE ===")
print("test_mode установлен в: ", test_mode)
print("=============================")
```

### 4. Добавлена отладка в `set_test_enemy()`
```gdscript
print("=== ОТЛАДКА SET_TEST_ENEMY ===")
print("test_enemy_scene установлен в: ", test_enemy_scene)
print("test_enemy_rarity установлен в: ", test_enemy_rarity)
print("===============================")
```

## Как использовать
1. Запустите игру
2. Перейдите в тестовую арену
3. Выберите врага и редкость
4. Начните бой
5. Проверьте консоль на наличие отладочных сообщений

## Ожидаемый результат
Теперь в консоли будет видно:
- Какие значения установлены в `set_test_mode()` и `set_test_enemy()`
- Какие значения проверяются в `spawn_enemy()`
- Какие значения проверяются в `_spawn_test_enemy()`

Это поможет определить, где именно происходит сброс или неправильная установка переменных.

## Возможные причины проблемы
1. **Переменные сбрасываются** где-то в коде между установкой и использованием
2. **Порядок вызовов** методов неправильный
3. **Асинхронность** - методы вызываются до того, как переменные установлены
4. **Перезапись переменных** в другом месте кода

## Следующие шаги
После получения отладочной информации можно будет точно определить причину и исправить проблему.

---

**Автор**: Claude AI Assistant  
**Дата**: 2024  
**Версия**: 1.0
