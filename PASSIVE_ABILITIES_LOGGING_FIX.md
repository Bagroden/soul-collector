# Исправление логирования пассивных способностей

## Проблема
В тестовом режиме пассивные способности работают, но логируются неправильно - показывают "не сработала" для всех способностей, которые просто не должны срабатывать в данный момент.

## Анализ логов

### Что работает:
- **Пассивные способности найдены** - "Найденные пассивные способности: ["thief_agility", "dodge", "sneaky_strike", "neurotoxin"]"
- **Активные способности работают** - "Враг использовал Ядовитый удар!"
- **Отравление работает** - "Игрок отравлен! 1 стак яда", "Яд усилен! Стаки: 2 из 3"
- **Уворот работает** - "Гоблин Вор увернулся от Спиритический удар!"

### Проблема с логированием:
- **"Гоблин Вор - Уворот (не сработала)"** - но потом "Гоблин Вор увернулся"
- **Все пассивные способности показывают "не сработала"** - даже те, которые работают правильно

## Корневая причина

### В `Scripts/Battle/body.gd` строка 633:
```gdscript
# Логируем неудачное срабатывание только для активных способностей
# (статические способности не логируются при неудаче)
_log_passive_ability(ability.name, false, result.get("message", ""))
```

**Проблема:** Логируются **ВСЕ** неудачные срабатывания пассивных способностей, включая те, которые просто не должны срабатывать в данный момент.

## Исправление

### Изменена логика логирования в `body.gd`:
```gdscript
if result.get("success", false):
    _handle_ability_result(result, target)
    _log_passive_ability(ability.name, true, result.get("message", ""))
else:
    # Логируем неудачное срабатывание только для способностей, которые должны срабатывать часто
    # (например, уворот, контратака), но не для статических способностей
    var should_log_failure = ability.id in ["dodge", "agility_dodge", "mouse_nimble", "quick_strike", "sneaky_strike"]
    if should_log_failure:
        _log_passive_ability(ability.name, false, result.get("message", ""))
```

### Логика исправления:
1. **Успешные срабатывания** - логируются всегда
2. **Неудачные срабатывания** - логируются только для способностей, которые должны срабатывать часто
3. **Статические способности** - не логируются при неудаче

## Список способностей для логирования неудач

### Логируются неудачи:
- **dodge** - уворот
- **agility_dodge** - ловкий уворот  
- **mouse_nimble** - крысиная ловкость
- **quick_strike** - быстрый удар
- **sneaky_strike** - скрытый удар

### НЕ логируются неудачи:
- **thief_agility** - ловкость вора (статическая)
- **neurotoxin** - нейротоксин (статическая)
- **fighter** - боец (статическая)
- **restlessness** - беспокойство (статическая)
- **blood_flow** - кровоток (статическая)
- **rage** - ярость (статическая)
- **revenge** - месть (статическая)

## Ожидаемые результаты

### До исправления:
```
Гоблин Вор - Уворот (не сработала)
Гоблин Вор - Ловкость вора (не сработала)
Гоблин Вор - Скрытый удар (не сработала)
Гоблин Вор - Нейротоксин (не сработала)
```

### После исправления:
```
Гоблин Вор - Уворот (не сработала)  # Только для способностей, которые должны срабатывать часто
Гоблин Вор - Скрытый удар (не сработала)  # Только для способностей, которые должны срабатывать часто
# Статические способности не логируются при неудаче
```

## Преимущества исправления

### 1. **Чистые логи**
- Убираются лишние сообщения о "не сработала"
- Фокус на реальных проблемах
- Лучшая читаемость логов

### 2. **Правильное понимание работы**
- Пассивные способности работают, но не логируются при неудаче
- Статические способности не должны логироваться при неудаче
- Только активные способности логируются при неудаче

### 3. **Улучшенная отладка**
- Легче найти реальные проблемы
- Меньше шума в логах
- Более точная диагностика

## Влияние на игровой процесс

### **Тестовая арена:**
- Логи стали чище и понятнее
- Пассивные способности работают как задумано
- Лучшая диагностика проблем

### **Обычная игра:**
- Логи остаются информативными
- Пассивные способности работают корректно
- Улучшенная читаемость

---

**Автор**: Claude AI Assistant  
**Дата**: 2024  
**Версия**: 1.0
